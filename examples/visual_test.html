<html>

<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.147.0/three.min.js" integrity="sha512-GWXLkqxMENYgBdQvA/lTeOV+R2auhasgKQxjMTWBFt3Z6GJVZ9owiyAMOzz0Wt6J1ri8bf/g2kHJV0uvWpJTuw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="module" defer>
        import SHG from "../dist/index.js";
        class Item {
            static init(scene, id) {
                const x = Math.random() * 100;
                const y = Math.random() * 60;
                const mesh = new THREE.Mesh(new THREE.PlaneGeometry(2, 2), new THREE.MeshBasicMaterial());
                mesh.position.set(x, y, 0);
                scene.add(mesh);
                return { id, x, y, mesh };
            }
        }
        class Level {
            static init(scene, camera) {
                const cs = 10;
                const cw = 100;
                const ch = 60;
                const shg = new SHG(cw, ch, cs);

                const geo = new THREE.PlaneGeometry(1, 1, cw / cs, ch / cs);
                const mat = new THREE.MeshBasicMaterial({ color: 0x00ffff, wireframe: true });
                const field = new THREE.Mesh(geo, mat);
                field.position.set(cw / 2, ch / 2, 1);
                camera.position.x = field.position.x;
                camera.position.y = field.position.y;
                field.scale.set(cw, ch, 1);
                scene.add(field);

                const geo2 = new THREE.PlaneGeometry();
                const mat2 = new THREE.MeshBasicMaterial({ color: 0x88ff00, wireframe: true });
                const view = new THREE.Mesh(geo2, mat2);
                scene.add(view);

                const items = [];
                for (let i = 0; i < 20; i++) {
                    const p = Item.init(scene, i.toString());
                    shg.set(p.id, p.x, p.y);
                    items.push(p);
                }

                view.position.set(40, 40);
                const s = 30;
                view.scale.set(s, s, 1);

                const nearbyIDs = shg.query(view.position.x, view.position.y, view.scale.x / 2);
                console.log(nearbyIDs);
                for (const p of items) {
                    if (nearbyIDs.includes(p.id)) {
                        p.mesh.material.color.setHex(0xff0000);
                    }
                }
            }
        }
        class Game {
            static init() {
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, 7 / 5, 0.1, 1000);
                camera.position.set(0, 0, 100);
                const renderer = new THREE.WebGLRenderer();
                renderer.setSize(700, 500);
                document.body.appendChild(renderer.domElement);
                const clock = new THREE.Clock();

                const level = Level.init(scene, camera);
                const g = { scene, camera, renderer, clock, level };
                g.renderer.render(g.scene, g.camera);
            }
        }
        Game.init();
    </script>
</body>

</html>